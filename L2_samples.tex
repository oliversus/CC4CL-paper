\section{L2 data - analysis and initial validation}\label{L2_data}

The analysis and initial validation of L2 data is twofold. We first examine CC4CL cloud properties for one sample scene that extends approximately from 100\textdegree\ W to 170\textdegree\ W and 45\textdegree\ N to 75\textdegree\ N over North America. We focus on the consistency of retrieval values derived from different sensors (AVHRR, MODIS, AATSR). This also includes pixel-based uncertainties of the key variables ctp, cot, cer, and cldmask. We then perform an initial validation of retrieved cloud properties, for which CALIOP-CALIPSO data are our truth reference. This validation is limited to three high-latitude scenes for which collocations for all sensors with CALIOP are available.

\subsection{CC4CL cloud properties}

The sample scene is characterized by various cloud types, and the CC4CL cloud mask defines only a relatively small fraction as cloud free (\cref{fig:CTP_intercomparison,fig:COT_intercomparison,fig:CER_intercomparison}).  When visually inspecting CC4CL output for CTP, COT, and CER, the retrieval data appear highly similar for the three different sensors. Main spatial patterns are resolved in all products. The data show that there are more cloud free AVHRR pixels, which is related to the coarser spatial resolution compared to MODIS and AATSR. The LST difference ranges from XY to XY minutes, and thus there is little cloud displacement between observation times.
 
CTP data are approximately normally distributed for all three sensors. Both COT and CER show positive kurtosis and skewness, as values close to 0 are most frequent. CER data are somewhat bimodal, having a primary peak at $\approx$12 micron and a secondary peak at $\approx$35 micron (\cref{fig:histograms,tab:retrieval_statistics}). Mean value differences are not significant between AVHRR and MODIS for CTP, MODIS and AATSR for COT, and AVHRR and AATSR for CER. The standard deviation of differences between two sensors are always lowest for AVHRR minus MODIS (\cref{tab:retrieval_statistics}). Significance tests of mean differences and standard deviations of residuals between sensor retrievals are sensitive to outliers. These are to some extent influenced by cloud displacement due to observation time differences. Even though we found no significant relationship between sensor retrieval residuals and observation time difference (data not shown), residuals are likely to be smaller and thus possibly insignificant if sensor obervation times were identical.
 
\subsection{Uncertainties}

Median absolute uncertainties are CTP = \load{NA2_ctp_unc_median}26.7 hPa, COT = \load{NA2_cot_unc_median}6.1, CER = \load{NA2_cer_unc_median}2.0 mic, and cloud mask = \load{NA2_cmask_unc_median}13.7 \% (\cref{fig:uncertainties}). The median relative retrieval uncertainty (not shown) is relatively low for all three retrieval variables (CTP = \load{NA2_ctp_unc_median_relative}4.7 \%, COT = \load{NA2_cot_unc_median_relative}6.1 \%, CER = \load{NA2_cer_unc_median_relative}2.0 \%). COT uncertainties increase with COT magnitude, and the RGB image (\cref{fig:RGB_07222058}) shows that largest uncertainties are found in cases of opaque cloud coverage and probably cloud over sea-ice surfaces. CER results are similar to COT, although relative uncertainties are somewhat lower. Cloud free areas show increased cloud mask uncertainties, and in particular over sea-ice surface areas. Note that the cloud mask uncertainties have been quantified as a function of the normalized difference to the cloud mask threshold, whereas relative retrieval uncertainties (100 $\times$ uncertainty $\div$ retrieved value) are shown for CTP, COT, and CER. 

\begin{table*}[t]
  \caption{Statistics of CTP, COT, and CER retrieval values for study area NA2 and AVHRR (first value in each cell), MODIS (second value), and AATSR (third value). $\Delta$ values are given for AVHRR minus MODIS (first value in each cell), AVHRR minus AATSR (second value), and MODIS minus AATSR (third value). $^{\ast}$t-Test p-value $>$ 0.1, indicating that differences in mean values are not significant.}
  \begin{tabular}{l|lllll}
    \hline
                 & mean & median & stddev & skewness & kurtosis \\
    \hline
             CTP & \load{ctpMeanN18}667.2, \load{ctpMeanMYD}665.0, \load{ctpMeanENV}645.2 & \load{ctpMedN18}667.8, \load{ctpMedMYD}668.1, \load{ctpMedENV}632.4 & \load{ctpStdN18}147.5, \load{ctpStdMYD}142.7, \load{ctpStdENV}146.2 & \load{ctpSkewN18}-0.2, \load{ctpSkewMYD}-0.2, \load{ctpSkewENV}0.1 & \load{ctpKurtN18}-0.4, \load{ctpKurtMYD}-0.4, \load{ctpKurtENV}-0.8 \\
    $\Delta$ CTP & \load{ctpdMeanN18}2.2$^{\ast}$, \load{ctpdMeanMYD}21.9, \load{ctpdMeanENV}19.7 & \load{ctpdMedN18}4.2, \load{ctpdMedMYD}22.3, \load{ctpdMedENV}18.5 & \load{ctpdStdN18}63.0, \load{ctpdStdMYD}138.7, \load{ctpdStdENV}138.9 & \load{ctpdSkewN18}-0.4, \load{ctpdSkewMYD}-0.3, \load{ctpdSkewENV}-0.3 & \load{ctpdKurtN18}8.2, \load{ctpdKurtMYD}1.0, \load{ctpdKurtENV}0.7 \\
             COT & \load{cotMeanN18}12.3, \load{cotMeanMYD}13.6, \load{cotMeanENV}13.4 & \load{cotMedN18}7.2, \load{cotMedMYD}8.6, \load{cotMedENV}8.8 & \load{cotStdN18}19.8, \load{cotStdMYD}19.7, \load{cotStdENV}17.6 & \load{cotSkewN18}6.6, \load{cotSkewMYD}5.7, \load{cotSkewENV}5.3 & \load{cotKurtN18}60.5, \load{cotKurtMYD}46.2, \load{cotKurtENV}40.8 \\
    $\Delta$ COT & \load{cotdMeanN18}-1.3, \load{cotdMeanMYD}-1.2, \load{cotdMeanENV}0.2$^{\ast}$ & \load{cotdMedN18}-0.6, \load{cotdMedMYD}-1.2, \load{cotdMedENV}-0.5 & \load{cotdStdN18}16.5, \load{cotdStdMYD}22.0, \load{cotdStdENV}21.3 & \load{cotdSkewN18}0.7, \load{cotdSkewMYD}2.4, \load{cotdSkewENV}1.8 & \load{cotdKurtN18}59.6, \load{cotdKurtMYD}41.5, \load{cotdKurtENV}33.1 \\
             CER & \load{cerMeanN18}21.1, \load{cerMeanMYD}19.2, \load{cerMeanENV}21.3 & \load{cerMedN18}16.5, \load{cerMedMYD}14.4, \load{cerMedENV}18.1 & \load{cerStdN18}13.0, \load{cerStdMYD}12.1, \load{cerStdENV}10.9 & \load{cerSkewN18}1.1, \load{cerSkewMYD}1.4, \load{cerSkewENV}0.6 & \load{cerKurtN18}1.4, \load{cerKurtMYD}1.2, \load{cerKurtENV}-0.8 \\
    $\Delta$ CER & \load{cerdMeanN18}1.9, \load{cerdMeanMYD}-0.2$^{\ast}$, \load{cerdMeanENV}-2.1 & \load{cerdMedN18}0.5, \load{cerdMedMYD}-1.0, \load{cerdMedENV}-1.9 & \load{cerdStdN18}7.0, \load{cerdStdMYD}11.6, \load{cerdStdENV}11.3 & \load{cerdSkewN18}0.8, \load{cerdSkewMYD}0.8, \load{cerdSkewENV}0.5 & \load{cerdKurtN18}7.9, \load{cerdKurtMYD}4.4, \load{cerdKurtENV}2.3 \\
    \hline
  \end{tabular}
  \label{tab:retrieval_statistics}
\end{table*}


\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/07222058_ctp_multi.png}
  \caption{CTP retrieval values for study area NA2 with data from AVHRR (left), MODIS (middle), and AATSR (right).}
  \label{fig:CTP_intercomparison}
%\end{figure*}

%\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/07222058_cot_multi.png}
  \caption{COT retrieval values for study area NA2 with data from AVHRR (left), MODIS (middle), and AATSR (right).}
  \label{fig:COT_intercomparison}
%\end{figure*}

%\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/07222058_cer_multi.png}
  \caption{CER retrieval values for study area NA2 with data from AVHRR (left), MODIS (middle), and AATSR (right).}
  \label{fig:CER_intercomparison}
\end{figure*}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=0.68\textwidth]{figures/07222058_uncertainties_absolute.png} %{figures/07222058_uncertainties_percent_goodspacing.png}
  \caption{Absolute uncertainties of MODIS AQUA retrieval data for study area NA2 and CTP [hPa], COT, CER [mic], and Cloud mask [\%].} %{Relative uncertainties [\%] of MODIS AQUA retrieval data for study area NA2 and CTP, COT, CER, and Cloud mask.}
  \label{fig:uncertainties}
\end{figure*}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/07222058_histograms.png}
  \caption{Density histograms of NOAA18, MODIS AQUA, and AATSR retrieval data for study area NA2 and (a) CTP, (b) COT, and (c) CER.}
  \label{fig:histograms}
\end{figure*}

\subsection{Validation with Calipso}

We found collocations between Calipso, AVHRR, MODIS, and AATSR for three study areas in the Arctic at 07/22/2008 19.15 LST (study area North America 1 = NA1, n = \load{NA1_length}120, \cref{fig:RGB_07221915}), 07/22/2008 20:58 LST (NA2, n = \load{NA2_length}163, \cref{fig:RGB_07222058}), and 07/27/2008 08.10 LST (Siberia = SIB, n = \load{SIB_length}116, \cref{fig:RGB_07270810}). These are located within 60\textdegree\ to 75\textdegree\ N latitude, and contain vegetated land, snow-covered land, open ocean, and sea-ice surfaces. For NA1 and SIB, all Calipso pixels were classified as cloud covered, but for NA2, about half of the pixels are cloud free.

When including AATSR, collocations are restricted to high latitude areas and the few pixels located at the intersection between Calipso and AATSR. We thus decided to extend the validation analysis by another scene without AATSR data, which we found in the Gulf of Guinea/West Africa between 7\textdegree\ S and 12\textdegree\ N at 24/10/2009 13.45 LST (Africa = AFR, n = \load{AFR_length}1181, \cref{fig:RGB_10241345}). For this scene, about ten times more pixel values are available than for the other scenes, displaying cloud systems such as low-level stratocumulus and deep convection that are not contained in the Arctic data shown here. 

We divided all study areas into logical sectors, for each of which a characteristic pattern of cloud coverage and type predominates. Moreover, the validation is shown for comparisons of CTH rather than CTP to enable a more intuitive visualization and discussion. CTH is derived from CTP and the retrieval's atmospheric profile and thus physically consistent. 

\subsubsection{Case studies}

\vspace{5mm}\underline{\textit{Case study NA1}}\vspace{2mm}

Study area NA1 is a completely cloud covered scene over northern Canada containing land, ice-covered land, and open ocean surfaces. There is a mix of single and multi-layered clouds of variable optical thickness and height. 
CC4CL correctly classifies pixels as cloud covered, except for a few cases in sectors 3 and 4. CTH retrievals are very consistent among the three sensors, and only differ in sector 2. Clouds are generally retrieved too low compared to Calipso's top layer, unless the latter is optically thick as in sector 4. In the case of a (semi-)transparent cloud top layer, multiple surfaces contribute to the observed satellite data. CC4CL CTH is then located closer to (sector 1), at (sector 3), or even below the underlying cloud layer (sector 2). For single layer, optically thick (COT $>$ 1) cloud coverage however, CC4CL and Calipso CTH agree very well (sector 4). Under such conditions, the retrieval of CTP and derived products using AVHRR heritage channel data is very accurate. Cloud phase agreement between CC4CL and Calipso is very variable. It is best for optically thick high ice cloud coverage (sector 1), and worst for low water clouds (sector 4).

\vspace{5mm}\underline{\textit{Case study NA2}}\vspace{2mm}

Study area NA2 is located entirely over snow/ice free land in Western Canada. Calipso cloud coverage is \load{cfree_calipso}4.5\%, spatially broken, and variable in height and phase. Clear sky pixels are mostly identified by CC4CL (\load{cfree_cc4cl_and_calipso_NA2}69.3\% correct), and cloudy pixels are rarely missed (\load{cloudy_cc4cl_and_calipso_NA2}78.7\% correct). CC4CL retrievals of thin high clouds and false positive cloudy pixels have low CTH values (sector 1). Calipso's small-scale horizontal variability in cloud phase is reflected by CC4CL data, which however overestimate the fraction of liquid water clouds in sector 2. CC4CL reproduces Calipso's spatial variability in CTH, which it only slightly underestimates by 0.5--1 km in sector 2. In sector 3 however, CC4CL considerably underestimates CTH by up to 7 km. Most of these clouds are optically and geometrically thin.

\vspace{5mm}\underline{\textit{Case study SIB}}\vspace{2mm}

Study area SIB crosses the Novaya Zemlya islands north of Siberia and is defined by a mixture of open ocean and partially snow/ice covered land surfaces. According to both Calipso and CC4CL, it is completely cloud covered. 

In case of single-layer cloudiness, CC4CL CTH agrees very well with Calipso (sector 1 and, in particular, sector 3). The CTH difference between CC4CL retrievals increases in the presence of overlapping clouds (sector 2). There are optically thin but vertically thick ($\approx$4 km) clouds in sector 2. For these the retrieved CTH is considerably underestimated by $\approx$6 km, which is probably a result of lower layer contributions that ``contaminate'' the satellite signals. Overall, about \load{phase_match_calipso_CC4CL_SIB_layer0}62.3 \% of CC4CL pixels agree with Calipso phase. Phase mismatch occurs in cases of single layer optically thin clouds (sector 2) and, less frequently, stratiform cloudiness (sector 3).

\vspace{5mm}\underline{\textit{Case study AFR}}\vspace{2mm}

Study area AFR is located over the Gulf of Guinea and Western Africa, thus containing open ocean and snow/ice free land surfaces. As we excluded AATSR data, about 10 times more pixel collocations with Calipso are available (n = 1181) than for the Arctic cases. Additionally, measurements contain tropical and coastal cloud systems such as extensive low-level stratiform cloudiness and continental deep convection (\cref{fig:RGB_10241345}).

In general, the quantitative and qualitative agreement between CC4CL and Calipso CTH is remarkable. CC4CL data track the spatial pattern of continental CTH very well (sector 3), which increases northwards and shows some small scale variability beyond 8\textdegree\ N. However, CC4CL underestimates CTH of vertically thick clouds and instead places the cloud top at a layer's vertical centre. The height of the stratiform cloud field is almost identical for CC4CL and Calipso, although CTH of near-surface stratiform clouds is overestimated below thin high cirrus (sector 1). For the small layer located at 4 km height at $\approx$ 6.7\textdegree\ S and the thin high cirrus layer around 2\textdegree\ S, MODIS retrieval values differ somewhat from CC4CL AVHRR and Calipso. Again, the phase of optically thick clouds is retrieved very well, which however is not the case for the thin ice cirrus clouds. Generally, CC4CL and the AVHRR heritage channel dataset are almost entirely insensitive to the very high, thin cloud layer in sector 1 (covering stratiform clouds) and 2 (covering the sea surface). Here, CC4CL is rather driven by contributions from very low clouds or the sea surface. 

\subsubsection{Validation summary}

The four study areas clearly show that CC4CL retrievals of CTH are very close to Calipso values for single layer, optically thick clouds. The mean CTH bias (CC4CL minus Calipso for layer COT $>$ 1) is just \load{NA1_ctp_bias_part}0.24 km for NA1 and pixels at $>$ 73.7\textdegree\ N, \load{SIB_ctp_bias_part}0.05 km for SIB at $>$ 74\textdegree\ N, and \load{AFR_ctp_bias_part}-0.01 km for AFR at $<$ 3\textdegree\ S. For multi-layer clouds, CC4CL estimates are almost exclusively located in between Calipso's top and bottom layer estimates. For these cases, the optimal estimation algorithm processes satellite signals that are likely to contain radiance contributions from multiple cloud layers. The OE then optimizes the fit between modelled and observed radiances by placing the cloud lower in the atmospheric profile, and so the mixed nature of the satellite data leads to an underestimation of CTH. %In general, underestimation of CTP is rare (\% of pixels whose CTP is CC4CL $<$ Calipso COT $>$ 1 = \load{NA1_cth_cci_lt_cal}25.3 (NA1), \load{NA2_cth_cci_lt_cal}20.2 (NA2), \load{SIB_cth_cci_lt_cal}25.6 (SIB), and \load{AFR_cth_cci_lt_cal}43.7 (AFR)).

There is no clear influence of the underlying land type or topography on retrieval values or the cloud mask. However, the limited sample size does not allow for generalizations. Only for site NA2, Calipso identified cloud-free pixels, \load{cfree_cc4cl_and_calipso_NA2}69.3\% of which were also detected as cloud-free by CC4CL's neural network cloud mask, and with few exceptions as low level water clouds otherwise. In relatively few cases, CC4CL fails to detect clouds seen by Calipso (\% of missed clouds = \load{cloudfree_calipso_cloudy_CC4CL_NA1}9.0 (NA1), \load{cloudfree_calipso_cloudy_CC4CL_NA2}21.3 (NA2), \load{cloudfree_calipso_cloudy_CC4CL_SIB}0.6 (SIB), \load{cloudfree_calipso_cloudy_CC4CL_AFR}3.1 (AFR)). We did not account for fractional cloud coverage, as we set a grid box as cloud covered if any corresponding CC4CL pixel contains cloud information. As a consequence, there are slightly more cloud covered pixels for the spatially higher resolved MODIS and AATSR data than AVHRR.

There is no Calipso cloud layer for which the comparison with CC4CL phase generally agrees best. After having rounded CC4CL values to the nearest integer, the percentage of pixels with equal phase is lowest for the top layer at COD $>$ 0 (NA1 = \load{phase_match_calipso_CC4CL_NA1_layer0}49.9 \%, NA2 = \load{phase_match_calipso_CC4CL_NA2_layer0}32.2 \%, SIB = \load{phase_match_calipso_CC4CL_SIB_layer0}62.3 \%, AFR = \load{phase_match_calipso_CC4CL_AFR_layer0}53.0 \%), but similar for the mid layer COD $>$ 0.15 (NA1 = \load{phase_match_calipso_CC4CL_NA1_layer1}53.1 \%, NA2 = \load{phase_match_calipso_CC4CL_NA2_layer1}46.5 \%, SIB = \load{phase_match_calipso_CC4CL_SIB_layer1}66.4 \%, AFR = \load{phase_match_calipso_CC4CL_AFR_layer1}94.7 \%), and the bottom layer COD $>$ 1 (NA1 = \load{phase_match_calipso_CC4CL_NA1_layer2}47.3 \%, NA2 = \load{phase_match_calipso_CC4CL_NA2_layer2}57.4 \%, SIB = \load{phase_match_calipso_CC4CL_SIB_layer2}66.3 \%, AFR = \load{phase_match_calipso_CC4CL_AFR_layer2}91.1 \%). These values however do show that phase determination performs very well if optically thick clouds dominate, as is the case for study area AFR. When averaged over all layers, phase agreement is largest for site AFR (\load{cph_match_calipso_CC4CL_AFR_layermean}79.6 \%), followed by SIB (\load{cph_match_calipso_CC4CL_SIB_layermean}65.0 \%), and clearly lower for NA1 (\load{cph_match_calipso_CC4CL_NA1_layermean}50.1 \%) and NA2 (\load{cph_match_calipso_CC4CL_NA2_layermean}45.4 \%).

For ice clouds, the most frequently occuring cloud types are cirrus (ID=6) for Calipso and overlap (ID=8) or cirrus (ID=7) for CC4CL. Water cloud types are more heterogeneous and for Calipso predominantly low transparent (ID=0), but altostratus (ID=5) and altocumulus (ID=4) are also frequent. CC4CL water clouds are approximately equally distributed amongst water (ID=3) and supercooled (ID=4) cloud types. %\textcolor{red}{Statistics: percentages for most frequent cloud types. Also: Which cloud type is dominant if CC4CL phase is different to Calipso phase?}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/RGB_N18_01x01_07221915.png} %RGB_multi_01x01_07221915.png}
  \caption{Study area NA1 (North America 1). Red (Ch1), green (Ch2), blue (Ch4 - Ch5) image derived from NOAA18 data resampled to 0.01\textdegree$\times$0.01\textdegree\ resolution. Date of observation is 07/22/2008, 19.15 LST. Orange lines: extent of the collocated MODIS granule, yellow lines: extent of the collocated AATSR orbit, red line: Calipso track outside (dashed) and within (solid) study area.}
  \label{fig:RGB_07221915}
  \includegraphics[width=\textwidth]{figures/calipsoVsCci_07221915_nocot_uncorrectedCtp.png}
  \caption{Vertical cross section of study area NA1 (North America 1) along the Calipso track at 5 km horizontal resolution. Top: CTH for CC4CL retrievals (coloured points) and Calipso measurements (vertical bars), and surface elevation and surface type (blue = open water, green = land, grey = snow/ice). The Calipso data are shown for those pressure layers where the cumulative top-to-bottom COD exceeds a threshold value of 0 (top layer), 0.15 (mid layer), and 1 (bottom layer). Bottom: Cloud mask/phase (ice to water = red to blue, cloud free = white, not determined = grey) and type (see \cref{tab:cloud_types} for key/value pairs) for all three Calipso layers and CC4CL retrievals. For CC4CL, cloud phase was averaged when resampling, and cloud type was assigned to the most frequent class per grid box. Sectors of characteristic cloud fields are separated by black vertical lines. Number of pixels n = \load{NA1_length}120}
  \label{fig:calipso_07221915}
\end{figure*}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/RGB_N18_01x01_07222058.png}
  %\includegraphics[width=\textwidth]{figures/RGB_multi_01x01_07222058.png}
  \caption{Study area NA2 (North America 2). As \autoref{fig:RGB_07221915}, but at 07/22/2008, 20.58 LST.}
  \label{fig:RGB_07222058}
  \includegraphics[width=\textwidth]{figures/calipsoVsCci_07222058_nocot_uncorrectedCtp.png}
  \caption{Study area NA2 (North America 2). As \autoref{fig:calipso_07221915}, but at 07/22/2008, 20.58 LST. n = \load{NA2_length}163}
  \label{fig:calipso_07222058}
\end{figure*}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/RGB_N18_01x01_07270810.png} %RGB_multi_01x01_07270810.png}
  \caption{Study area SIB (Siberia). As \autoref{fig:RGB_07221915}, but at 07/27/2008, 08.10 LST.}
  \label{fig:RGB_07270810}
  \includegraphics[width=\textwidth]{figures/calipsoVsCci_07270810_nocot_uncorrectedCtp.png}
  \caption{Study area SIB (Siberia). As \autoref{fig:calipso_07221915}, but at 07/27/2008, 08.10 LST. n = \load{SIB_length}116}
  \label{fig:calipso_07271915}
\end{figure*}

\begin{figure*}[h]
  %\centering
  \includegraphics[width=\textwidth]{figures/RGB_N18_01x01_10241345.png} %RGB_multi_01x01_07270810.png}
  \caption{Study area AFR (Africa). As \autoref{fig:RGB_07221915}, but at 10/24/2009, 13.45 LST.}
  \label{fig:RGB_10241345}
  \includegraphics[width=\textwidth]{figures/calipsoVsCci_10241345_nocot_uncorrectedCtp.png}
  \caption{Study area AFR (Africa). As \autoref{fig:calipso_07221915}, but at 10/24/2009, 13.45 LST. Due to space restrictions, no cloud type values are shown in table. n = \load{AFR_length}1181} 
  \label{fig:calipso_10241345}
\end{figure*}


% satellite orbits to be analysed:
% see file L2_samples/collocations.txt
% selection: $2008/07/22, UTC 19:15 - 19:19, Lat 70 - 73, Lon -109 - -112$
